# NWD/NWH AWS console login
type: trigger
name: crowdsecurity/aws-cloudtrail-nwo-nwd-console-login
description: "Detect console login outside of office hours"
filter: |
 evt.Meta.log_type == 'aws-cloudtrail' &&
 evt.Meta.event_name == 'ConsoleLogin' &&
 evt.Unmarshaled.cloudtrail.responseElements?.ConsoleLogin == 'Success' &&
 (
   (evt.Time.Hour() >= 22 || evt.Time.Hour() < 10)
   || (evt.Time.Weekday().String() in ['Saturday','Sunday'])
 )
groupby: evt.Meta.source_ip
scope:
 type: AwsARN
 expression: evt.Meta.user_arn
